name: "python-sandbox"
description: "Sandbox for AI code execution"

mode: ONCE
time_limit: 60
max_cpus: 1

# Resource limits
rlimit_as_type: HARD
rlimit_as: 512
rlimit_cpu_type: HARD
rlimit_cpu: 60
rlimit_fsize_type: HARD
rlimit_fsize: 10
rlimit_nofile_type: HARD
rlimit_nofile: 64

# Namespace isolation
clone_newnet: false
clone_newuser: true
clone_newns: true
clone_newpid: true
clone_newipc: true
clone_newuts: true
clone_newcgroup: true

# Run as unprivileged user inside sandbox
uidmap {
    inside_id: "1000"
    outside_id: "1000"
    count: 1
}

gidmap {
    inside_id: "1000"
    outside_id: "1000"
    count: 1
}

# Python environment (read-only)
mount {
    src: "/opt/sandbox/python"
    dst: "/python"
    is_bind: true
    rw: false
}

# Temp directory (writable tmpfs)
mount {
    dst: "/tmp"
    fstype: "tmpfs"
    options: "size=50M,mode=1777"
}

# Required device nodes
mount {
    src: "/dev/null"
    dst: "/dev/null"
    is_bind: true
    rw: true
}

mount {
    src: "/dev/urandom"
    dst: "/dev/urandom"
    is_bind: true
    rw: false
}

# Proc filesystem (needed for some Python operations)
mount {
    dst: "/proc"
    fstype: "proc"
    rw: false
}

# DNS resolution (needed for network access)
mount {
    src: "/etc/resolv.conf"
    dst: "/etc/resolv.conf"
    is_bind: true
    rw: false
}

# SSL certificates (needed for HTTPS)
mount {
    src: "/etc/ssl/certs"
    dst: "/etc/ssl/certs"
    is_bind: true
    rw: false
}

mount {
    src: "/usr/share/ca-certificates"
    dst: "/usr/share/ca-certificates"
    is_bind: true
    rw: false
}

# The workspace gets bind-mounted at runtime via --bindmount flag

# Security
keep_caps: false
disable_no_new_privs: false

# Logging
log_level: WARNING
