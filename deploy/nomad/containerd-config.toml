# containerd configuration for Virtues
# This file is a reference — the actual config is generated by setup.sh
#
# Three gVisor runtimes are registered:
#   runsc          — Base runtime, no overlay (for stateless services like Tollbooth)
#   runsc-standard — Standard tier, 2GB root filesystem overlay
#   runsc-pro      — Pro tier, 5GB root filesystem overlay
#
# The overlay2 limit is per-container and governs the root filesystem only.
# The /data bind mount (SQLite database) uses ext4 project quotas instead.

version = 2

[plugins]
  [plugins."io.containerd.grpc.v1.cri"]
    sandbox_image = "registry.k8s.io/pause:3.9"

    [plugins."io.containerd.grpc.v1.cri".containerd]
      default_runtime_name = "runsc"

      [plugins."io.containerd.grpc.v1.cri".containerd.runtimes]
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
          runtime_type = "io.containerd.runc.v2"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]
            SystemdCgroup = true

        # gVisor base runtime (no overlay — for Tollbooth)
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc]
          runtime_type = "io.containerd.runsc.v1"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc.options]
            TypeUrl = "io.containerd.runsc.v1.options"
            ConfigPath = "/etc/containerd/runsc.toml"

        # gVisor standard tier runtime (2GB root filesystem overlay)
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc-standard]
          runtime_type = "io.containerd.runsc-standard.v1"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc-standard.options]
            TypeUrl = "io.containerd.runsc.v1.options"
            ConfigPath = "/etc/containerd/runsc-standard.toml"

        # gVisor pro tier runtime (5GB root filesystem overlay)
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc-pro]
          runtime_type = "io.containerd.runsc-pro.v1"
          [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runsc-pro.options]
            TypeUrl = "io.containerd.runsc.v1.options"
            ConfigPath = "/etc/containerd/runsc-pro.toml"
