# gVisor (runsc) base configuration for Virtues
# This is the base runtime config â€” no overlay, used by Tollbooth and other
# stateless services that don't write to their root filesystem.
#
# Tier-specific configs (runsc-standard.toml, runsc-pro.toml) are generated
# by setup.sh with overlay2 enforcement for the container root filesystem.
#
# The actual config files on the server are generated by setup.sh during
# cloud-init provisioning. This file serves as a reference.
#
# Storage enforcement summary:
#   Container root fs (/):  gVisor overlay2 (2GB standard, 5GB pro)
#   Tenant data (/data):    ext4 project quotas (10GB standard, 40GB pro)
#   Bulk storage (S3):      App-level quotas (500GB standard, 4TB pro)

[runsc]
  # Platform: systrap is most compatible, kvm is faster if available
  platform = "systrap"

  # Network: use sandbox mode (network namespace from containerd/CNI)
  network = "sandbox"

  # File access: shared required for SQLite WAL mode (mmap shared memory)
  file-access = "shared"

  # Enable gofer host UDS for shared memory
  # Required for SQLite WAL concurrent access
  fsgofer-host-uds = true

  # Direct filesystem access for better performance
  directfs = true

  # No overlay for the base runtime (stateless services like Tollbooth).
  # Tier-specific runtimes use:
  #   overlay2 = "root:dir:/var/lib/runsc/runsc-standard/overlay,size=2g"
  #   overlay2 = "root:dir:/var/lib/runsc/runsc-pro/overlay,size=5g"
  overlay2 = "none"

  # Logging (disable in production for performance)
  debug = false
  # debug-log = "/var/log/runsc/"

  # Strace for debugging syscall issues (disable in production)
  # strace = true
  # strace-syscalls = "open,openat,read,write,mmap"
