/**
 * ProseMirror Theme Styles
 *
 * Styles for the page editor including:
 * - Base editor styling
 * - Entity links, external links
 * - Media players (audio, video)
 * - File cards
 * - Checkboxes
 * - Tables
 * - AI edit highlights
 */

/* =============================================================================
   BASE EDITOR STYLES
   ============================================================================= */

.ProseMirror {
	position: relative;
	outline: none;
	font-family: var(--font-sans, ui-sans-serif, system-ui, -apple-system, sans-serif);
	font-size: 1rem;
	line-height: 1.6;
	color: var(--color-foreground);
	white-space: pre-wrap;
	word-wrap: break-word;
	overflow: visible;
}

.ProseMirror:focus {
	outline: none;
}

.ProseMirror p {
	margin: 0 0 1rem 0;
}

.ProseMirror p:last-child {
	margin-bottom: 0;
}

/* Placeholder for empty editor */
.ProseMirror > .is-empty:first-child::before {
	content: attr(data-placeholder);
	color: var(--color-foreground-muted);
	font-style: normal;
	pointer-events: none;
	float: left;
	height: 0;
	opacity: 0.5;
}

/* Selection */
.ProseMirror ::selection {
	background: var(--color-highlight);
}

/* =============================================================================
   HEADINGS
   ============================================================================= */

.ProseMirror h1,
.ProseMirror h2,
.ProseMirror h3,
.ProseMirror h4,
.ProseMirror h5,
.ProseMirror h6 {
	font-family: var(--font-serif, Georgia, 'Times New Roman', serif);
	font-weight: 400;
	color: var(--color-foreground);
	margin: 1.5rem 0 0.75rem 0;
}

.ProseMirror h1:first-child,
.ProseMirror h2:first-child,
.ProseMirror h3:first-child {
	margin-top: 0;
}

.ProseMirror h1 { font-size: 1.75rem; line-height: 1.3; }
.ProseMirror h2 { font-size: 1.375rem; line-height: 1.35; }
.ProseMirror h3 { font-size: 1.125rem; line-height: 1.4; font-weight: 500; }
.ProseMirror h4 { font-size: 1rem; line-height: 1.5; font-weight: 500; }
.ProseMirror h5 { font-size: 0.9375rem; line-height: 1.5; font-weight: 600; }
.ProseMirror h6 { font-size: 0.875rem; line-height: 1.5; font-weight: 600; }

/* =============================================================================
   INLINE FORMATTING
   ============================================================================= */

.ProseMirror strong {
	font-weight: 700;
}

.ProseMirror em {
	font-style: italic;
}

.ProseMirror u {
	text-decoration: underline;
}

.ProseMirror del {
	text-decoration: line-through;
	color: var(--color-foreground-subtle);
}

.ProseMirror code {
	font-family: var(--font-mono, ui-monospace, monospace);
	font-size: 0.875em;
	background-color: var(--color-surface);
	padding: 0.125rem 0.375rem;
	border-radius: 0.25rem;
}

/* =============================================================================
   LINKS
   ============================================================================= */

.ProseMirror a {
	color: var(--color-primary);
	text-decoration: none;
	cursor: pointer;
}

.ProseMirror a:hover {
	text-decoration: underline;
}

/* =============================================================================
   ENTITY LINKS
   Note: Styles moved to src/lib/styles/entity-badge.css for unification
   ============================================================================= */

/* =============================================================================
   IMAGES
   ============================================================================= */

.pm-image-wrapper {
	display: block;
	margin: 0.5rem 0;
}

.pm-image {
	max-width: 100%;
	height: auto;
	border-radius: 0.375rem;
}

.pm-image-error {
	color: var(--color-foreground-subtle);
	font-style: italic;
}

.pm-image-placeholder {
	color: var(--color-foreground-subtle);
	font-size: 0.875rem;
}

/* =============================================================================
   AUDIO PLAYER
   ============================================================================= */

.pm-audio-wrapper {
	display: block;
	margin: 0.5rem 0;
	padding: 0.75rem;
	background-color: var(--color-surface);
	border-radius: 0.5rem;
	border: 1px solid var(--color-border);
}

.pm-audio-header {
	display: flex;
	align-items: center;
	gap: 0.5rem;
	margin-bottom: 0.5rem;
	color: var(--color-foreground-muted);
}

.pm-audio-name {
	font-size: 0.875rem;
	font-weight: 500;
	color: var(--color-foreground);
}

.pm-audio-player {
	width: 100%;
	height: 32px;
	outline: none;
}

/* =============================================================================
   VIDEO PLAYER
   ============================================================================= */

.pm-video-wrapper {
	display: block;
	margin: 0.5rem 0;
}

.pm-video-player {
	width: 100%;
	max-width: 100%;
	height: auto;
	border-radius: 0.5rem;
	background-color: var(--color-surface);
}

/* =============================================================================
   FILE CARD
   ============================================================================= */

.pm-file-card {
	display: inline-flex;
	align-items: center;
	gap: 0.5rem;
	padding: 0.5rem 0.75rem;
	background-color: var(--color-surface);
	border: 1px solid var(--color-border);
	border-radius: 0.5rem;
	color: var(--color-foreground);
	text-decoration: none;
	cursor: pointer;
	transition: background-color 0.15s ease, border-color 0.15s ease;
}

.pm-file-card:hover {
	background-color: var(--color-surface-elevated);
	border-color: var(--color-primary);
	text-decoration: none;
}

.pm-file-card-name {
	font-size: 0.875rem;
	font-weight: 500;
}

/* =============================================================================
   CHECKBOX
   ============================================================================= */

.pm-checkbox {
	appearance: none;
	width: 14px;
	height: 14px;
	border: 1.5px solid var(--color-border);
	border-radius: 3px;
	background-color: transparent;
	cursor: pointer;
	vertical-align: middle;
	margin-right: 6px;
	position: relative;
	transition: all 0.15s ease;
}

.pm-checkbox:hover {
	border-color: var(--color-primary);
}

.pm-checkbox:checked {
	background-color: var(--color-primary);
	border-color: var(--color-primary);
}

.pm-checkbox:checked::after {
	content: '';
	position: absolute;
	left: 4px;
	top: 1px;
	width: 4px;
	height: 8px;
	border: solid white;
	border-width: 0 2px 2px 0;
	transform: rotate(45deg);
}

/* =============================================================================
   HORIZONTAL RULE
   ============================================================================= */

.pm-hr,
.ProseMirror hr {
	border: none;
	border-top: 1px solid var(--color-border);
	margin: 1rem 0;
}

/* =============================================================================
   BLOCKQUOTE
   ============================================================================= */

.ProseMirror blockquote {
	border-left: 3px solid var(--color-border);
	padding-left: 1rem;
	margin: 0.5rem 0;
	color: var(--color-foreground-muted);
	font-style: italic;
}

/* =============================================================================
   CODE BLOCK
   ============================================================================= */

.ProseMirror pre {
	font-family: var(--font-mono, ui-monospace, monospace);
	font-size: 0.875em;
	background-color: var(--color-surface);
	padding: 1rem;
	border-radius: 0.375rem;
	overflow-x: auto;
	margin: 0.5rem 0;
}

.ProseMirror pre code {
	background: none;
	padding: 0;
	border-radius: 0;
}

/* =============================================================================
   LISTS
   ============================================================================= */

.ProseMirror ul {
	padding-left: 1.5rem;
	margin: 0.5rem 0;
	list-style-type: disc;
}

/* Nested bullet lists alternate styles */
.ProseMirror ul ul {
	list-style-type: circle;
}

.ProseMirror ul ul ul {
	list-style-type: square;
}

.ProseMirror ol {
	padding-left: 1.5rem;
	margin: 0.5rem 0;
	/* Don't set list-style-type here - let inline styles from schema control it */
}

/* Nested ordered lists - inherit parent style but alternate for roman */
.ProseMirror ol[style*="upper-roman"] ol {
	list-style-type: lower-roman;
}

.ProseMirror ol[style*="lower-roman"] ol {
	list-style-type: upper-roman;
}

/* Default nested ordered lists use alternating styles */
.ProseMirror ol ol {
	list-style-type: lower-alpha;
}

.ProseMirror ol ol ol {
	list-style-type: lower-roman;
}

.ProseMirror li {
	margin: 0.25rem 0;
	display: list-item;
}

.ProseMirror li p {
	margin: 0;
}

/* =============================================================================
   TABLES
   ============================================================================= */

.ProseMirror table {
	width: 100%;
	border-collapse: separate;
	border-spacing: 0;
	margin: 0.5rem 0;
	font-size: 0.875rem;
	border: 1px solid var(--color-border-subtle);
	border-radius: 6px;
	overflow: hidden;
}

.ProseMirror th,
.ProseMirror td {
	padding: 0.5rem 1rem;
	border-right: 1px solid var(--color-border-subtle);
	border-bottom: 1px solid var(--color-border-subtle);
	text-align: left;
}

.ProseMirror th:last-child,
.ProseMirror td:last-child {
	border-right: none;
}

.ProseMirror tr:last-child th,
.ProseMirror tr:last-child td {
	border-bottom: none;
}

.ProseMirror th {
	background-color: var(--color-surface-elevated);
	font-weight: 400;
	font-family: var(--font-serif, Georgia, serif);
}

.ProseMirror tr:hover td {
	background-color: var(--color-background);
}

/* Table cell selection (prosemirror-tables) */
.ProseMirror .selectedCell {
	background: color-mix(in srgb, var(--color-primary) 15%, transparent);
}

/* =============================================================================
   AI EDIT HIGHLIGHTS
   ============================================================================= */

/* AI edit highlight - shows where AI made changes */
.pm-ai-highlight {
	background-color: color-mix(in srgb, var(--color-success) 15%, transparent);
	border-bottom: 2px solid var(--color-success);
	border-radius: 2px;
	padding: 0 1px;
}

/* =============================================================================
   GAPCURSOR (for navigating between blocks)
   ============================================================================= */

.ProseMirror-gapcursor {
	display: none;
	pointer-events: none;
	position: absolute;
}

.ProseMirror-gapcursor:after {
	/* Hidden - keeps navigation working but removes visual indicator */
	display: none;
}

@keyframes ProseMirror-cursor-blink {
	to { visibility: hidden; }
}

.ProseMirror-focused .ProseMirror-gapcursor {
	display: block;
}

/* =============================================================================
   ENTITY PICKER (@ mentions)
   ============================================================================= */

.pm-entity-mention-active {
	background-color: color-mix(in srgb, var(--color-primary) 15%, transparent);
	border-radius: 2px;
}

/* =============================================================================
   SLASH COMMANDS
   ============================================================================= */

.pm-slash-command-active {
	background-color: color-mix(in srgb, var(--color-primary) 15%, transparent);
	border-radius: 2px;
}

/* =============================================================================
   LINE NUMBERS (with drag handle functionality)
   ============================================================================= */

/* Wrapper uses flexbox: gutter on left, editor on right */
.has-line-gutter {
	display: flex;
}

.has-line-gutter > .ProseMirror {
	flex: 1;
	min-width: 0;
}

/* Gutter container */
.pm-line-gutter {
	position: relative;
	width: 2rem;
	flex-shrink: 0;
	transition: width 0.15s ease;
}

/* Line number element */
.pm-line-number {
	position: absolute;
	left: 0;
	right: 0;
	height: 1.6rem;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 0.7rem;
	font-family: var(--font-mono, ui-monospace, monospace);
	color: var(--color-foreground-subtle);
	cursor: grab;
	user-select: none;
	transition: color 0.15s ease, background-color 0.15s ease;
}

.pm-line-number:hover {
	color: var(--color-foreground);
	background-color: var(--color-surface-elevated);
}

.pm-line-number.dragging {
	cursor: grabbing;
	color: var(--color-primary);
	background-color: var(--color-primary-subtle);
}

/* Drag ghost (custom drag image) */
.pm-drag-ghost {
	position: fixed;
	top: 0;
	left: 0;
	padding: 0.375rem 0.75rem;
	background-color: var(--color-primary);
	color: white;
	font-size: 0.75rem;
	font-family: var(--font-sans, ui-sans-serif, system-ui, sans-serif);
	font-weight: 500;
	border-radius: 0.25rem;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
	pointer-events: none;
	z-index: 9999;
	white-space: nowrap;
}

/* Drop indicator (full-width line showing where block will be inserted) */
.pm-drop-indicator {
	position: fixed;
	height: 2px;
	background-color: var(--color-primary);
	border-radius: 1px;
	pointer-events: none;
	z-index: 100;
	opacity: 0;
	transition: opacity 0.1s ease;
}

.pm-drop-indicator::before,
.pm-drop-indicator::after {
	content: '';
	position: absolute;
	top: 50%;
	transform: translateY(-50%);
	width: 6px;
	height: 6px;
	background-color: var(--color-primary);
	border-radius: 50%;
}

.pm-drop-indicator::before {
	left: -3px;
}

.pm-drop-indicator::after {
	right: -3px;
}

.pm-drop-indicator.visible {
	opacity: 1;
}

/* Drop cursor (from prosemirror-dropcursor) */
.ProseMirror-dropcursor {
	position: absolute;
	z-index: 100;
	height: 2px;
	background-color: var(--color-primary);
	pointer-events: none;
}

/* =============================================================================
   MARK DECORATIONS (show markdown delimiters on current line)
   ============================================================================= */

.pm-mark-delimiter {
	color: var(--color-foreground-subtle);
	font-family: var(--font-mono, ui-monospace, monospace);
	font-size: 0.9em;
	opacity: 0.5;
	user-select: none;
	pointer-events: none;
}

.pm-mark-delimiter-open {
	margin-right: 0;
}

.pm-mark-delimiter-close {
	margin-left: 0;
}

/* =============================================================================
   MEDIA UPLOAD PLACEHOLDERS
   ============================================================================= */

.pm-upload-placeholder {
	display: inline-flex;
	align-items: center;
	gap: 0.5rem;
	padding: 0.5rem 1rem;
	margin: 0.25rem 0;
	border-radius: 6px;
	background-color: var(--color-surface-elevated);
	border: 1px solid var(--color-border-subtle);
	font-size: 0.875rem;
	color: var(--color-foreground-muted);
}

.pm-upload-progress {
	display: inline-flex;
	align-items: center;
	gap: 0.5rem;
}

.pm-upload-spinner {
	width: 16px;
	height: 16px;
	border: 2px solid var(--color-border-subtle);
	border-top-color: var(--color-primary);
	border-radius: 50%;
	animation: pm-upload-spin 0.8s linear infinite;
}

@keyframes pm-upload-spin {
	to {
		transform: rotate(360deg);
	}
}

.pm-upload-text {
	max-width: 200px;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

.pm-upload-percent {
	color: var(--color-foreground-subtle);
	font-variant-numeric: tabular-nums;
}

.pm-upload-error {
	display: inline-flex;
	align-items: center;
	gap: 0.5rem;
	color: var(--color-error);
}

.pm-upload-error-icon {
	font-size: 1rem;
}

.pm-upload-error-text {
	font-size: 0.875rem;
}
